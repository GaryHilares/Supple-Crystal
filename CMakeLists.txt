cmake_minimum_required(VERSION 3.0.0)
project(Supple-Crystal VERSION 0.1.0)

include(CTest)
enable_testing()

set(CMAKE_BUILD_TYPE "Debug")
set(CMAKE_CXX_STANDARD 17)

if(NOT (CMAKE_BUILD_TYPE STREQUAL "Release") AND NOT (CMAKE_BUILD_TYPE STREQUAL "Debug"))
    message(FATAL_ERROR "CMAKE_BUILD_TYPE not recognized.")
endif()

set(SFML_DIR "extlibs/SFML-2.5.1/lib/cmake/SFML")
find_package(SFML COMPONENTS main graphics window system REQUIRED)

file(GLOB_RECURSE CPPSources RELATIVE ${CMAKE_SOURCE_DIR} "src/*.cpp")
if(CMAKE_BUILD_TYPE STREQUAL "Release")
    make_directory("${CMAKE_BINARY_DIR}/Release")
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/Release")
    add_executable(Supple-Crystal WIN32 ${CPPSources} resource/icon.rc)
elseif(CMAKE_BUILD_TYPE STREQUAL "Debug")
    make_directory("${CMAKE_BINARY_DIR}/Debug")
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/Debug")
    add_executable(Supple-Crystal ${CPPSources} resource/icon.rc)
endif()
target_include_directories(Supple-Crystal PUBLIC ./extlibs/SFML-2.5.1/include)
target_link_libraries(Supple-Crystal sfml-main sfml-graphics sfml-window sfml-system)

if(CMAKE_BUILD_TYPE STREQUAL "Release")
    make_directory("${CMAKE_BINARY_DIR}/Release/assets")
    file(COPY "assets/logo_bg-true_resized.png" DESTINATION "${CMAKE_BINARY_DIR}/Release/assets")
    file(COPY "extlibs/SFML-2.5.1/bin/sfml-graphics-2.dll" DESTINATION "${CMAKE_BINARY_DIR}/Release")
    file(COPY "extlibs/SFML-2.5.1/bin/sfml-window-2.dll" DESTINATION "${CMAKE_BINARY_DIR}/Release")
    file(COPY "extlibs/SFML-2.5.1/bin/sfml-system-2.dll" DESTINATION "${CMAKE_BINARY_DIR}/Release")
elseif(CMAKE_BUILD_TYPE STREQUAL "Debug")
    make_directory("${CMAKE_BINARY_DIR}/Debug/assets")
    file(COPY "assets/logo_bg-true_resized.png" DESTINATION "${CMAKE_BINARY_DIR}/Debug/assets")
    file(COPY "extlibs/SFML-2.5.1/bin/sfml-graphics-d-2.dll" DESTINATION "${CMAKE_BINARY_DIR}/Debug")
    file(COPY "extlibs/SFML-2.5.1/bin/sfml-window-d-2.dll" DESTINATION "${CMAKE_BINARY_DIR}/Debug")
    file(COPY "extlibs/SFML-2.5.1/bin/sfml-system-d-2.dll" DESTINATION "${CMAKE_BINARY_DIR}/Debug")
endif()

set(CPACK_PROJECT_NAME ${PROJECT_NAME})
set(CPACK_PROJECT_VERSION ${PROJECT_VERSION})
include(CPack)
